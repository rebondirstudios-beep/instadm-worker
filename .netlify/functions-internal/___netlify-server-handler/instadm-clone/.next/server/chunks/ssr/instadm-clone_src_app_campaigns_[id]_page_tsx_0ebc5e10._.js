module.exports=[90958,a=>{"use strict";var b=a.i(87924),c=a.i(98003),d=a.i(50944),e=a.i(63588),f=a.i(210),g=a.i(14548),h=a.i(81560),i=a.i(38246),j=a.i(72131);function k(){let a=(0,d.useRouter)(),k=(0,d.useParams)(),{user:l,isLoaded:m}=(0,c.useUser)(),[n,o]=(0,j.useState)(!1),[p,q]=(0,j.useState)(!1),[r,s]=(0,j.useState)(null),[t,u]=(0,j.useState)(""),[v,w]=(0,j.useState)([]),[x,y]=(0,j.useState)(""),[z,A]=(0,j.useState)([]),[B,C]=(0,j.useState)(!1),[D,E]=(0,j.useState)(!1),[F,G]=(0,j.useState)(!1),[H,I]=(0,j.useState)(0),[J,K]=(0,j.useState)(""),[L,M]=(0,j.useState)(!1),[N,O]=(0,j.useState)(!0),P=(0,j.useRef)(null);(0,j.useEffect)(()=>{m&&!l&&a.push("/login")},[m,a,l]);let Q=k?.id,R=Array.isArray(Q)?Q[0]:Q;(0,j.useEffect)(()=>{if(!m||!l||!R)return;let a=!1;return(async()=>{o(!0);try{let b=await fetch(`/api/campaigns/${R}`),c=await b.json().catch(()=>({}));if(!b.ok)throw Error(c?.error||`Failed to load campaign (HTTP ${b.status})`);if(a)return;let d=c?.campaign??null;s(d);let e=d?.settings?.leadUsernames;Array.isArray(e)?u(e.join("\n")):u("")}catch(b){a||window.alert(b?.message||"Failed to load campaign")}finally{a||o(!1)}})(),()=>{a=!0}},[R,m,l]),(0,j.useEffect)(()=>{if(!m||!l)return;let a=!1;return(async()=>{try{let b=await fetch("/api/accounts"),c=await b.json().catch(()=>({}));if(!b.ok)throw Error(c?.error||`Failed to load accounts (HTTP ${b.status})`);if(a)return;let d=Array.isArray(c?.accounts)?c.accounts:[];w(d),!x&&d[0]?.id&&y(d[0].id)}catch{}})(),()=>{a=!0}},[m,l,x]);let S=(0,j.useCallback)(async()=>{if(R&&x){E(!0);try{let a=await fetch(`/api/campaigns/${R}/messages?instagramAccountId=${encodeURIComponent(x)}`),b=await a.json().catch(()=>({}));if(!a.ok)throw Error(b?.error||`Failed to load outbox (HTTP ${a.status})`);A(Array.isArray(b?.messages)?b.messages:[])}catch(a){window.alert(a?.message||"Failed to load outbox")}finally{E(!1)}}},[R,x]);(0,j.useEffect)(()=>{m&&l&&R&&x&&S()},[R,m,S,x,l]);let T=(0,j.useCallback)(()=>{if(N)try{let a=window.AudioContext||window.webkitAudioContext;if(!a)return;let b=new a,c=b.createOscillator(),d=b.createGain();c.type="sine",c.frequency.value=880,d.gain.value=.03,c.connect(d),d.connect(b.destination),c.start(),setTimeout(()=>{try{c.stop(),b.close()}catch{}},90)}catch{}},[N]),U=async a=>{try{await navigator.clipboard.writeText(a),window.alert("Copied to clipboard")}catch{window.alert("Copy failed")}},V=async(a,b)=>{try{await navigator.clipboard.writeText(b)}catch{window.alert("Copy failed")}let c=`https://ig.me/m/${encodeURIComponent(a)}`;try{P.current&&!P.current.closed?(P.current.location.href=c,P.current.focus()):(P.current=window.open(c,"ig_dm"),P.current||(window.location.href=c))}catch{P.current=window.open(c,"ig_dm"),P.current||(window.location.href=c)}T()},W=(0,j.useMemo)(()=>z.filter(a=>"sent"!==a.status),[z]),X=(0,j.useMemo)(()=>F?W[H]??null:null,[F,W,H]),Y=async()=>{if(K(""),!x)return void window.alert("Select an account first");if(0===z.length)return void window.alert("Queue messages first");let a=W.findIndex(a=>"sent"!==a.status),b=a>=0?a:0;W[b]?(I(b),G(!0),await V(W[b].recipientUsername,W[b].content)):window.alert("No pending messages")},Z=()=>{G(!1),K(""),M(!1)},$=async a=>{(K(""),W[a])?(I(a),await V(W[a].recipientUsername,W[a].content)):G(!1)},_=async()=>{if(X)try{await ad(X.id,"sent"),await S(),await $(H)}catch(a){K(a?.message||"Failed to mark sent")}},aa=async()=>{await $(H+1)};(0,j.useEffect)(()=>{if(!F)return;let a=a=>{if("Escape"===a.key){a.preventDefault(),Z();return}if("Enter"===a.key||"s"===a.key.toLowerCase()){a.preventDefault(),_();return}if("Space"===a.code){if(!X)return;a.preventDefault(),V(X.recipientUsername,X.content);return}if("n"===a.key.toLowerCase()){a.preventDefault(),aa();return}if("o"===a.key.toLowerCase()){if(!X)return;a.preventDefault(),V(X.recipientUsername,X.content)}};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[X,F,_,aa]);let ab=async()=>{if(R){if(!x)return void window.alert("Select an account first");C(!0);try{let a=await fetch(`/api/campaigns/${R}/queue`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({instagramAccountId:x,limit:50})}),b=await a.json().catch(()=>({}));if(!a.ok)throw Error(b?.error||`Failed to queue (HTTP ${a.status})`);await S()}catch(a){window.alert(a?.message||"Failed to queue messages")}finally{C(!1)}}},ac=async()=>{if(!R)return;if(!x)return void window.alert("Select an account first");let a=r?.settings?.leadUsernames||[];if(!a.length)return void window.alert("No lead usernames to queue");C(!0);try{let b=await fetch(`/api/campaigns/${R}/queue`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({instagramAccountId:x,usernames:a})}),c=await b.json().catch(()=>({}));if(!b.ok)throw Error(c?.error||`Failed to queue all (HTTP ${b.status})`);await S()}catch(a){window.alert(a?.message||"Failed to queue all messages")}finally{C(!1)}},ad=async(a,b)=>{try{let c=await fetch(`/api/messages/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:b})}),d=await c.json().catch(()=>({}));if(!c.ok)throw Error(d?.error||`Failed to update message (HTTP ${c.status})`);A(c=>c.map(c=>c.id===a?{...c,status:b}:c))}catch(a){window.alert(a?.message||"Failed to update message")}},ae=(0,j.useMemo)(()=>{let a=t.split(/\r?\n/).map(a=>a.trim()).filter(Boolean).map(a=>a.startsWith("@")?a.slice(1):a),b=[],c=new Set;for(let d of a){let a=d.toLowerCase();c.has(a)||(c.add(a),b.push(d))}return b},[t]),af=(0,j.useMemo)(()=>!!r&&!!r.name.trim(),[r]),ag=async()=>{if(r){q(!0);try{let a={...r.settings??{},leadUsernames:ae},b=await fetch(`/api/campaigns/${r.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r.name,description:r.description,status:r.status,settings:a})}),c=await b.json().catch(()=>({}));if(!b.ok)throw Error(c?.error||`Failed to save campaign (HTTP ${b.status})`);let d=c?.campaign??null;s(d),window.alert("Saved")}catch(a){window.alert(a?.message||"Failed to save campaign")}finally{q(!1)}}},ah=async()=>{if(r&&window.confirm("Delete this campaign?"))try{let b=await fetch(`/api/campaigns/${r.id}`,{method:"DELETE"}),c=await b.json().catch(()=>({}));if(!b.ok)throw Error(c?.error||`Failed to delete campaign (HTTP ${b.status})`);a.push("/campaigns")}catch(a){window.alert(a?.message||"Failed to delete campaign")}};return m&&l?(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsx)("nav",{className:"bg-white border-b border-gray-200",children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(i.default,{href:"/",className:"flex items-center space-x-2",children:[(0,b.jsx)(e.MessageSquare,{className:"h-8 w-8 text-purple-600"}),(0,b.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:"Rebondir Studios"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,b.jsx)(i.default,{href:"/dashboard",className:"text-gray-600 hover:text-gray-900",children:"Dashboard"}),(0,b.jsx)(i.default,{href:"/campaigns",className:"text-purple-600 font-medium",children:"Campaigns"}),(0,b.jsx)(i.default,{href:"/accounts",className:"text-gray-600 hover:text-gray-900",children:"Accounts"}),(0,b.jsx)(i.default,{href:"/templates",className:"text-gray-600 hover:text-gray-900",children:"Templates"}),(0,b.jsx)(i.default,{href:"/analytics",className:"text-gray-600 hover:text-gray-900",children:"Analytics"}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("div",{className:"w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center text-white font-semibold",children:l.firstName?.[0]||l.emailAddresses[0]?.emailAddress[0]?.toUpperCase()}),(0,b.jsx)("span",{className:"text-gray-700",children:l.firstName||l.emailAddresses[0]?.emailAddress})]})]})]})})}),(0,b.jsxs)("main",{className:"max-w-4xl mx-auto px-6 py-8",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsxs)(i.default,{href:"/campaigns",className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[(0,b.jsx)(f.ArrowLeft,{className:"h-5 w-5"}),(0,b.jsx)("span",{children:"Back to Campaigns"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsxs)("button",{type:"button",onClick:ah,className:"px-3 py-2 rounded-lg border border-gray-300 text-red-600 hover:bg-red-50 flex items-center space-x-2",disabled:!r,children:[(0,b.jsx)(h.Trash2,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Delete"})]}),(0,b.jsxs)("button",{type:"button",onClick:ag,className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center space-x-2 disabled:opacity-50",disabled:!r||p||!af,children:[(0,b.jsx)(g.Save,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:p?"Saving...":"Save"})]})]})]}),(0,b.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:n&&!r?(0,b.jsx)("div",{className:"text-gray-600",children:"Loading..."}):r?(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name"}),(0,b.jsx)("input",{type:"text",value:r.name,onChange:a=>s(b=>b?{...b,name:a.target.value}:b),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,b.jsxs)("select",{value:r.status,onChange:a=>s(b=>b?{...b,status:a.target.value}:b),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[(0,b.jsx)("option",{value:"draft",children:"draft"}),(0,b.jsx)("option",{value:"active",children:"active"}),(0,b.jsx)("option",{value:"paused",children:"paused"}),(0,b.jsx)("option",{value:"completed",children:"completed"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,b.jsx)("textarea",{rows:3,value:r.description,onChange:a=>s(b=>b?{...b,description:a.target.value}:b),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Brand usernames"}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsxs)("span",{className:"text-xs text-gray-500",children:[ae.length," usernames"]}),ae.length>0&&(0,b.jsx)("button",{type:"button",onClick:()=>u(""),className:"text-xs text-red-600 hover:text-red-700 transition-colors",children:"Delete All"})]})]}),(0,b.jsx)("div",{className:"border border-gray-300 rounded-lg p-3 bg-gray-50 min-h-[240px] max-h-[240px] overflow-y-auto",children:0===ae.length?(0,b.jsx)("div",{className:"text-gray-400 text-sm",children:"No usernames added yet."}):(0,b.jsx)("div",{className:"space-y-1",children:ae.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between py-1 px-2 rounded hover:bg-gray-100 transition-colors",children:[(0,b.jsxs)("span",{className:"text-sm text-gray-900",children:["@",a]}),(0,b.jsx)("button",{type:"button",onClick:()=>{u(ae.filter(b=>b!==a).join("\n"))},className:"text-red-500 hover:text-red-700 transition-colors",title:"Delete username",children:(0,b.jsx)(h.Trash2,{className:"h-3 w-3"})})]},a))})}),(0,b.jsx)("textarea",{rows:1,value:t,onChange:a=>u(a.target.value),className:"sr-only","aria-label":"Raw usernames input"})]}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Paste usernames here, save, then use the Outbox below to send manually on Instagram Web in Chrome."}),(0,b.jsxs)("div",{className:"border-t border-gray-200 pt-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Outbox"}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("button",{type:"button",onClick:Y,className:"px-3 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",disabled:!x||0===z.length,children:"Start Session"}),(0,b.jsx)("button",{type:"button",onClick:S,className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",disabled:!x||D,children:D?"Refreshing...":"Refresh"})]})]}),(0,b.jsxs)("p",{className:"text-sm text-gray-500 mb-4",children:["Use ",(0,b.jsx)("span",{className:"font-medium",children:"Copy + Open"})," to copy the DM and open the Instagram message window. Then paste + send manually in Instagram Web, and click ",(0,b.jsx)("span",{className:"font-medium",children:"Mark Sent"})," here."]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,b.jsxs)("div",{className:"md:col-span-2",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sending Account"}),(0,b.jsxs)("select",{value:x,onChange:a=>y(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[(0,b.jsx)("option",{value:"",children:"Select account..."}),v.filter(a=>a.isActive).map(a=>(0,b.jsxs)("option",{value:a.id,children:["@",a.username," (",a.stats.dailyUsed,"/",a.stats.dailyLimit," today)"]},a.id))]}),0===v.length&&(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"No accounts yet. Add one on the Accounts page."})]}),(0,b.jsxs)("div",{className:"flex items-end space-x-2",children:[(0,b.jsx)("button",{type:"button",onClick:ab,className:"flex-1 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50",disabled:!x||B,children:B?"Queuing...":"Queue Up To 50"}),(0,b.jsx)("button",{type:"button",onClick:ac,className:"flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",disabled:!x||B,children:B?"Queuing...":"Queue All"})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl border border-gray-100 overflow-hidden",children:[(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Recipient"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Message"}),(0,b.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-gray-200",children:z.map(a=>(0,b.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-gray-900",children:["@",a.recipientUsername]}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700",children:a.status}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700",children:(0,b.jsx)("div",{className:"max-w-md line-clamp-2",children:a.content})}),(0,b.jsx)("td",{className:"px-4 py-3 text-right text-sm",children:(0,b.jsxs)("div",{className:"flex items-center justify-end space-x-3",children:[(0,b.jsx)("button",{type:"button",className:"text-purple-600 hover:text-purple-900",onClick:()=>U(a.content),children:"Copy"}),(0,b.jsx)("button",{type:"button",className:"text-blue-600 hover:text-blue-800",onClick:()=>V(a.recipientUsername,a.content),children:"Copy + Open"}),(0,b.jsx)("button",{type:"button",className:"text-green-600 hover:text-green-800",onClick:()=>ad(a.id,"sent"),disabled:"sent"===a.status,children:"Mark Sent"}),(0,b.jsx)("button",{type:"button",className:"text-red-600 hover:text-red-800",onClick:()=>ad(a.id,"failed"),children:"Fail"})]})})]},a.id))})]})}),0===z.length&&(0,b.jsx)("div",{className:"p-6 text-sm text-gray-500",children:"No messages queued for this account yet."})]})]}),(0,b.jsxs)("div",{className:"text-sm text-gray-500",children:[(0,b.jsxs)("div",{children:["Created: ",new Date(r.createdAt).toLocaleString()]}),(0,b.jsxs)("div",{children:["Updated: ",new Date(r.updatedAt).toLocaleString()]})]})]}):(0,b.jsx)("div",{className:"text-gray-600",children:"Campaign not found."})}),F&&X&&(0,b.jsx)("div",{className:"fixed bottom-4 right-4 z-50 w-[360px] max-w-[calc(100vw-2rem)]",children:(0,b.jsx)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-xs text-gray-500",children:"Sending session"}),(0,b.jsxs)("div",{className:"font-semibold text-gray-900 truncate",children:["@",X.recipientUsername]}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[H+1,"/",W.length," pending"]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("button",{type:"button",onClick:()=>O(a=>!a),className:"px-2 py-1 text-xs border border-gray-300 rounded-lg hover:bg-gray-50",children:N?"Sound: On":"Sound: Off"}),(0,b.jsx)("button",{type:"button",onClick:()=>M(a=>!a),className:"px-2 py-1 text-xs border border-gray-300 rounded-lg hover:bg-gray-50",children:L?"Hide":"Show"}),(0,b.jsx)("button",{type:"button",onClick:Z,className:"px-2 py-1 text-xs border border-gray-300 rounded-lg hover:bg-gray-50",children:"Stop"})]})]}),L&&(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Message"}),(0,b.jsx)("div",{className:"whitespace-pre-wrap text-sm text-gray-800 border border-gray-200 rounded-lg p-3 bg-gray-50 max-h-48 overflow-auto",children:X.content}),J&&(0,b.jsx)("div",{className:"text-sm text-red-600 mt-2",children:J}),(0,b.jsx)("div",{className:"text-[11px] text-gray-500 mt-2",children:"Shortcuts: Enter/S = Sent & Next, N = Next, O/Space = Copy + Open, Esc = Stop"})]}),(0,b.jsxs)("div",{className:"mt-3 grid grid-cols-3 gap-2",children:[(0,b.jsx)("button",{type:"button",onClick:()=>V(X.recipientUsername,X.content),className:"px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50",children:"Copy + Open"}),(0,b.jsx)("button",{type:"button",onClick:aa,className:"px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50",children:"Next"}),(0,b.jsx)("button",{type:"button",onClick:_,className:"px-3 py-2 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Sent & Next"})]})]})})})]})]}):null}a.s(["default",()=>k])}];

//# sourceMappingURL=instadm-clone_src_app_campaigns_%5Bid%5D_page_tsx_0ebc5e10._.js.map